{# Imports ----------------------------------------------------------------------------------------------------------------------------- #}

{% from "components/toaster.njk" import toaster %}
{% from "components/announcementBanner.njk" import announcementBanner with context %}
{% from "components/container.njk" import container %}
{% from "components/section.njk" import section %}
{% from "components/button.njk" import button %}
{% from "components/navbar.njk" import navbar with context %}
{% from "assets.njk" import logo, sparkle, blobDefaultTop, blobDefaultBottom %}

{# Values ------------------------------------------------------------------------------------------------------------------------------ #}

{% set htmlStyles = "scroll-smooth scroll-p-site-block" %}
{% set bodyStyles = "bg-space font-body text-neutral text-body-base antialiased flex flex-col min-h-dvh w-screen overflow-x-hidden items-center pb-[calc(env(safe-area-inset-bottom)+var(--announcementBannerBlockSize))]" %}

{# ------------------------------------------------------------------------------------------------------------------------------------- #}

<!DOCTYPE html>
<html
    {% if showNavbar %} {# checks if the layout template includes the navbar or not #}
        x-data="{
            scrollable: true,
            navbarHidden: false,
            navbarHeight: 0,
            lastScrollY: window.scrollY,
            hasScrolled: false,
            setHasScrolled() {
                if (this.lastScrollY > this.navbarHeight) {
                    this.hasScrolled = true
                } else {
                    this.hasScrolled = false
                }
            },
            setNavbarHeight() {
                setTimeout(() => {
                    if (this.navbarHidden) {
                        this.navbarHeight = 0;
                    } else {
                        this.navbarHeight = document.querySelector(`[x-ref='navbar']`).offsetHeight;
                    }
                }, 10);
            },
            setNavbarHidden() {
                const currentScrollY = window.scrollY;
                if (currentScrollY > this.lastScrollY && this.hasScrolled) {
                    this.navbarHidden = true
                } else if (currentScrollY < this.lastScrollY + 100  && this.hasScrolled) {
                    this.navbarHidden = false
                }
                this.setNavbarHeight()
                this.lastScrollY = currentScrollY
            },
            init() { {# sets navbar height on js load #}
                this.setNavbarHeight()
            }
        }"
        x-effect="setNavbarHeight()"
        @resize.window="setNavbarHeight()"
        @scroll.window="setHasScrolled"
        :style="{'--space-navbar-height': navbarHeight + 'px'}"
    {% endif %}
    lang="en"
    class="relative {{ htmlStyles }}">

    <head>
        {% include "snippets/htmlHead.njk" %}
    </head>

    <body
    :class="!scrollable && 'overflow-y-hidden'"
    class="{{ bodyStyles }}">
        {# Skip to content link #}
        <a class="absolute top-0 left-0 opacity-0 z-[-1111111]" href="#main" aria-label="skip to main content">Click to skip to main content</a>
        {% block blobs %}
            {{ blobDefaultTop({class:"top-0 h-[20vh] w-full left-1/2 -translate-x-1/2"}) }}
            {{ blobDefaultBottom({class:"bottom-0 h-[25vh] w-full left-1/2 -translate-x-1/2"}) }}
        {% endblock %}


        {% if global.bannerContent %}
            {{ announcementBanner({content: global.bannerContent }) }}
        {% endif %}

        {% if showNavbar %}
            {{navbar({sticky:true}) }}
        {% endif %}


        {{ toaster() }}

        <main id="main" class="@container flex flex-col justify-center w-full grow {{ mainStyles }}">
            {% block content %}{% endblock %}
        </main>

        {% block footer %}{% endblock %}


{# ------------------------------------------------------------------------------------------------------------------------------------- #}

        {% if showTopLine %}
            <div class="hidden lg:block z-(--z-top-elevated) w-screen h-lines border-b border-neutral-lighter"></div>
        {% endif %}

        <div class="block z-(--z-top-elevated) fixed pointer-events-none border-x border-neutral-lighter h-lvh w-[calc(100vw-2*var(--space-lines))]"></div>

        {% if showBottomLine %}
            <div class="block z-(--z-top-elevated) w-screen h-lines border-t border-neutral-lighter"></div>
        {% endif %}

{# ------------------------------------------------------------------------------------------------------------------------------------- #}

        {% if environment.env == 'dev' %}
            {% include "components/_developmentWidget.njk" %}
        {% endif %}

        {% include "snippets/scripts.njk" %}


    </body>
</html>
